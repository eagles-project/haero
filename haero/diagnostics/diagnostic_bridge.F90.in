!> This module is a bridge between the @CXX_CLASS_NAME@ C++ class and the
!> @F90_MODULE_NAME Fortran module.
module @F90_MODULE_NAME@_bridge

  implicit none
  private

  ! Module functions
  public :: @F90_MODULE_NAME@_init, &
            @F90_MODULE_NAME@_run, &
            @F90_MODULE_NAME@_finalize

contains

! Initializes the prognostic process.
subroutine @F90_MODULE_NAME@_init() bind(c)
  use haero, only: model
  use @F90_MODULE_NAME@, only: init
  implicit none

  call init(model)
end subroutine

! Runs the prognostic process, computing tendencies
subroutine @F90_MODULE_NAME@_run(t, dt, progs, atm, diags, tends) bind(c)
  use iso_c_binding, only: c_ptr, c_f_pointer
  use haero_precision, only: wp
  use haero, only: model, &
                   prognostics_t, atmosphere_t, diagnostics_t, &
                   prognostics_from_c_ptr, atmosphere_from_c_ptr, &
                   diagnostics_from_c_ptr

  use @F90_MODULE_NAME@, only: run
  implicit none

  ! Arguments
  real(wp), value, intent(in) :: t     ! simulation time
  type(c_ptr), value, intent(in) :: progs ! prognostic variables
  type(c_ptr), value, intent(in) :: atm   ! atmospheric state
  type(c_ptr), value, intent(in) :: diags ! diagnostic variables

  ! Fortran prognostics, atmosphere, diagnostics, tendencies types
  type(prognostics_t) :: prognostics
  type(atmosphere_t)  :: atmosphere
  type(diagnostics_t) :: diagnostics

  ! Get Fortran data types from our C pointers.
  prognostics = prognostics_from_c_ptr(progs)
  atmosphere = atmosphere_from_c_ptr(atm)
  diagnostics = diagnostics_from_c_ptr(diags)

  ! Call the actual subroutine.
  call update(model, t, prognostics, atmosphere, diagnostics)
end subroutine

! Finalizes the diagnostic process
subroutine @F90_MODULE_NAME@_finalize() bind(c)
  use haero, only: model
  use @F90_MODULE_NAME@, only: finalize
  implicit none

  call finalize(model)
end subroutine

end module

