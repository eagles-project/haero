
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.9">
    
    
      
        <title>The Haero Driver - Haero: A High Performance Aerosol Model Implementation for E3SM</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2b4465f4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-haero-driver" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Haero: A High Performance Aerosol Model Implementation for E3SM" class="md-header__button md-logo" aria-label="Haero: A High Performance Aerosol Model Implementation for E3SM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Haero: A High Performance Aerosol Model Implementation for E3SM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              The Haero Driver
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/eagles-project/haero" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Haero: A High Performance Aerosol Model Implementation for E3SM" class="md-nav__button md-logo" aria-label="Haero: A High Performance Aerosol Model Implementation for E3SM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Haero: A High Performance Aerosol Model Implementation for E3SM
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/eagles-project/haero" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../physics/" class="md-nav__link">
        Aerosol Physics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../library/" class="md-nav__link">
        The Haero Library
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../processes/" class="md-nav__link">
        Aerosol Processes
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          The Haero Driver
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        The Haero Driver
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#column-dynamics" class="md-nav__link">
    Column Dynamics
  </a>
  
    <nav class="md-nav" aria-label="Column Dynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#physical-interpretation" class="md-nav__link">
    Physical interpretation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    Initialization
  </a>
  
    <nav class="md-nav" aria-label="Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#discretized-column" class="md-nav__link">
    Discretized Column
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-thickness" class="md-nav__link">
    Layer thickness
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-haero-atmosphere" class="md-nav__link">
    Creating a Haero atmosphere
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time-stepping" class="md-nav__link">
    Time Stepping
  </a>
  
    <nav class="md-nav" aria-label="Time Stepping">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-microphysics" class="md-nav__link">
    Simple microphysics
  </a>
  
    <nav class="md-nav" aria-label="Simple microphysics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vertical-velocity" class="md-nav__link">
    Vertical velocity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaporation-and-condensation" class="md-nav__link">
    Evaporation and condensation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoconversion" class="md-nav__link">
    Autoconversion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accretion" class="md-nav__link">
    Accretion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rainwater-sedimentation" class="md-nav__link">
    Rainwater sedimentation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#turbulent-mixing" class="md-nav__link">
    Turbulent mixing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedded-parameterization" class="md-nav__link">
    Embedded parameterization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        Testing Aerosol Processes
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#column-dynamics" class="md-nav__link">
    Column Dynamics
  </a>
  
    <nav class="md-nav" aria-label="Column Dynamics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#physical-interpretation" class="md-nav__link">
    Physical interpretation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    Initialization
  </a>
  
    <nav class="md-nav" aria-label="Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#discretized-column" class="md-nav__link">
    Discretized Column
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-thickness" class="md-nav__link">
    Layer thickness
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-haero-atmosphere" class="md-nav__link">
    Creating a Haero atmosphere
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time-stepping" class="md-nav__link">
    Time Stepping
  </a>
  
    <nav class="md-nav" aria-label="Time Stepping">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-microphysics" class="md-nav__link">
    Simple microphysics
  </a>
  
    <nav class="md-nav" aria-label="Simple microphysics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vertical-velocity" class="md-nav__link">
    Vertical velocity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaporation-and-condensation" class="md-nav__link">
    Evaporation and condensation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoconversion" class="md-nav__link">
    Autoconversion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accretion" class="md-nav__link">
    Accretion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rainwater-sedimentation" class="md-nav__link">
    Rainwater sedimentation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#turbulent-mixing" class="md-nav__link">
    Turbulent mixing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#embedded-parameterization" class="md-nav__link">
    Embedded parameterization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="the-haero-driver">The Haero Driver</h1>
<p>The standalone driver program <code>haero_driver</code> provides a simple way to
explore the capabilities of Haero. It's a simple single-column model with a
bundled one-dimensional dynamics package. With it, you can</p>
<ul>
<li>run single-column aerosol simulations</li>
<li>perform statistical analysis on ensembles consisting of several columns</li>
<li>conduct time-step convergence studies to build confidence in Haero's
  mathematical algorithms and their implementations</li>
<li>select specific aerosol processes and parametrizations to examine
  in isolation, to debug or verify a given algorithm</li>
<li>study how the aerosol processes interact with one-dimensional dynamics
  and other simplified physical process representations</li>
</ul>
<p>In this chapter we describe the driver and its capabilities.</p>
<h2 id="column-dynamics">Column Dynamics</h2>
<p>We use a one-dimensional (vertical) atmosphere and tests of increasing
complexity.</p>
<p>Let <span class="arithmatex">\(z=z(a,t)\)</span> denote the trajectory of the particle labeled <span class="arithmatex">\(a\)</span> that arrives at physical position <span class="arithmatex">\(z\)</span> at time <span class="arithmatex">\(t\)</span>.
The label <span class="arithmatex">\(a\)</span> is the Lagrangian, or material, coordinate.
Particle trajectories are defined by</p>
<div class="arithmatex">\[\begin{equation} \label{traj}
\deriv{z}{t}(a,t) = w(z(a,t),t),
\end{equation}\]</div>
<p>where <span class="arithmatex">\(w(z,t)\)</span> is the vertical velocity.</p>
<p>In the following sections, it will be convenient to formulate \ref{traj} in
terms of the geopotential <span class="arithmatex">\(\phi(a,t) = gz(a,t)\)</span>,</p>
<div class="arithmatex">\[\begin{equation} \label{geo_traj}
  \deriv{\phi}{t}(a,t) = gw\left(\frac{\phi(a,t)}{g},t\right).
\end{equation}\]</div>
<p>Adiabatic column dynamics are described by the 1D Euler equations for a moist
atmosphere,</p>
<div class="arithmatex">\[\begin{align}
  \totd{w} &amp;= -g\left(\frac{1}{\rho}\partd{p}{\phi} + 1\right), \label{momentum}\\
  \totd{\rho} &amp;= - g\rho \partd{w}{\phi}, \label{eq:continuity}\\
  \totd{\theta_v} &amp;= 0, \label{eq:thermo},\\
  \totd{q_v} &amp;= 0, \label{eq:qv}
\end{align}\]</div>
<p>where <span class="arithmatex">\(\rho\)</span> is density, <span class="arithmatex">\(p\)</span> is pressure, <span class="arithmatex">\(\theta_v\)</span> is the virtual potential
temperature, and <span class="arithmatex">\(q_v\)</span> is the water vapor mass mixing ratio. As in
\cite{Taylor2020}, we treat virtual potential temperature <span class="arithmatex">\(\theta_v\)</span> as a
material invariant.</p>
<p>The momentum, continuity, thermodynamic equation, and transport equation
(respectfully) combine with \ref{geo_traj} and the equation of state</p>
<div class="arithmatex">\[\begin{equation}\label{eos}
  \frac{p}{\Pi} = \rho R \theta_v,
\end{equation}\]</div>
<p>to define the complete system. Above, <span class="arithmatex">\(\Pi = (p/p_{ref})^{\kappa}\)</span> is the
nondimensional Exner pressure, with constant <span class="arithmatex">\(\kappa = R/c_p\)</span>, where <span class="arithmatex">\(R\)</span> is the
dry air gas constant and <span class="arithmatex">\(c_p\)</span> is the specific heat of dry air at constant
pressure. We have 6 prognostic variables (<span class="arithmatex">\(\phi, w, \rho, \theta_v, q_v, p\)</span>),
and 6 equations. The boundary conditions are <span class="arithmatex">\(w(0,t) = w(z_{top},t) = 0\)</span>.</p>
<p>The advantage of the Lagrangian frame of reference imposed by \ref{geo_traj} is
that the material derivative becomes an ordinary time derivative, <span class="arithmatex">\(D/Dt = d/dt\)</span>.
Hence, for the remainder of this note we simply use <span class="arithmatex">\(d/dt\)</span> in our notation.</p>
<p>We begin with an ansatz that the velocity has a simple form,</p>
<div class="arithmatex">\[\begin{equation}\label{z_vel}
  w(z,t) = w_0\sin\frac{\pi z}{z_{top}}\sin \frac{2\pi t}{t_p},
\end{equation}\]</div>
<p>where we have introduced parameters for the maximum velocity, <span class="arithmatex">\(w_0\)</span>, the top of
the model column, <span class="arithmatex">\(z_{top}\)</span>, and the period of oscillation <span class="arithmatex">\(t_p\)</span>.
This velocity satisfies the boundary conditions and the initial condition, <span class="arithmatex">\(w(z,0) = 0\)</span>.
We assume that this velocity is valid for all time throughout the whole column, from <span class="arithmatex">\(z=0\)</span> to <span class="arithmatex">\(z=z_{top}\)</span>.
In terms of the geopotential, \ref{z_vel} becomes</p>
<div class="arithmatex">\[\begin{equation}\label{eq:phi_vel}
  w(\phi,t) = w_0 \sin \frac{\pi \phi}{g z_{top}}\sin\frac{2\pi t}{t_p}.
\end{equation}\]</div>
<p>Since velocity is prescribed, it does not need to be prognosed. This eliminates
\ref{momentum} from our system of equations \eqref{eq:1d}.
Our goal is to derive the other variables associated with 1D motion in a non-hydrostatic column so that we have consistent dynamics and thermodynamics.</p>
<p>Substituting \ref{phi_vel} into \ref{geo_traj}, we discover a separable ODE,</p>
<div class="arithmatex">\[\begin{align}
  \deriv{\phi}{t} &amp;= gw_0\sin\frac{\pi \phi}{g z_{top}}\sin\frac{2\pi t}{t_p},\\
  \Rightarrow \int \csc\frac{\pi \phi}{g z_{top}}\,d\phi &amp;= g w_0\int\sin\frac{2\pi t}{t_p}\,dt,
\end{align}\]</div>
<p>whose solution is</p>
<div class="arithmatex">\[\begin{equation}\label{phi_sol}
  \phi(t) = \frac{2gz_{top}}{\pi}\arctan\left[\tan\frac{\pi \phi_0}{2g z_{top}}\exp\left(\frac{w_0t_p}{z_{top}} \sin^2 \frac{\pi t}{t_p}\right)\right].
\end{equation}\]</div>
<p>![Geopotential <span class="arithmatex">\(\phi(t)\)</span> for <span class="arithmatex">\(\phi_0 = gz_0\)</span> and <span class="arithmatex">\(z_0\)</span> values listed in the
  legend, with parameters <span class="arithmatex">\(w_0=5\)</span>, <span class="arithmatex">\(T_{v0}=300\)</span>, <span class="arithmatex">\(\Gamma_v=0.01\)</span>,
  <span class="arithmatex">\(z_{top}=20000\)</span>, <span class="arithmatex">\(t_p=900\)</span>.]](images/geopotential_plot.pdf)</p>
<p>We use \ref{phi_vel} to find the divergence, which is required by the continuity
equation \ref{continuity}</p>
<div class="arithmatex">\[\begin{equation}\label{div}
  \partd{w}{\phi}(\phi,t) = \frac{\pi w_0}{g z_{top}}\cos\frac{\pi \phi(t)}{gz_{top}}\sin\frac{2\pi t}{t_p}.
\end{equation}\]</div>
<p>Substituting \ref{div} into \ref{continuity}, we find another separable ODE:</p>
<div class="arithmatex">\[\begin{align}
  \deriv{\rho}{t} &amp;= -\rho \left(\frac{\pi w_0}{z_{top}}\cos\frac{\pi \phi(t)}{g z_{top}}\sin\frac{2\pi t}{t_p}\right)\\
  \Rightarrow \int \frac{1}{\rho}\,d\rho &amp;= -\frac{\pi w_0}{z_{top}}\cos\frac{\pi \phi(t)}{z_{top}}\int \sin \frac{2\pi t}{t_p}\,dt.
\end{align}\]</div>
<p>The solution is</p>
<div class="arithmatex">\[\begin{align} \label{density}
  \rho(\phi(t),t) = \rho_0(\phi_0)\exp\left[\frac{ w_0 t_p}{2z_{top}}\left(\cos\frac{\pi {\phi}(t)}{gz_{top}}\cos\frac{2\pi t}{t_p}-\cos\frac{\pi {\phi_0}}{gz_{top}}\right)\right].
\end{align}\]</div>
<p><img alt="Density \(\rho(\phi(t),t)\) for \(\phi_0 = gz_0\) and \(z_0\) values listed in the
  legend, with parameters \(w_0=5\), \(T_{v0}=300\), \(\Gamma_v=0.01\),
  \(z_{top}=20000\), \(t_p=900\)." src="../images/density_plot.pdf" /></p>
<p>To find the pressure, we use \ref{density} in \ref{eos}:</p>
<div class="arithmatex">\[\begin{align}
  \frac{p}{\Pi} &amp;= R\rho(\phi(t),t)\theta_v(\phi(t),t),\notag \\
  p(\phi(t),t) &amp;= \left(p_{ref}^{-\kappa} R \rho(\phi(t),t)\theta_v(\phi(t),t)\right)^{1/(1-\kappa)}.\label{eq:pressure}
\end{align}\]</div>
<p><img alt="Pressure \(p(\phi(t),t)\) for \(\phi_0 = gz_0\) and \(z_0\) values listed in the
  legend, with parameters \(w_0=5\), \(T_{v0}=300\), \(\Gamma_v=0.01\),
  \(z_{top}=20000\), \(t_p=900\)." src="../images/pressure_plot.pdf" /></p>
<h3 id="physical-interpretation">Physical interpretation</h3>
<p>Physically, the ansatz \eqref{eq:z_vel} may be interpreted via \ref{momentum}
as defining the balance between buoyancy, the pressure gradient force, and
gravity to be</p>
<div class="arithmatex">\[\begin{align}
  -g\left(1 +  \frac{1}{\rho}\partd{p}{\phi}\right) &amp;= \deriv{w}{t}(\phi,t), \notag \\
  &amp;= \frac{2\pi w_0}{t_p}\sin\frac{\pi\phi}{gz_{top}}\cos\frac{2\pi t}{t_p} + \frac{\pi w_0^2}{2z_{top}}\sin\frac{2\pi\phi}{gz_{top}}\sin^2\frac{2\pi t}{t_p},
\end{align}\]</div>
<p>where the right-hand side is the time derivative of \ref{phi_vel}.</p>
<p>It is most straightforward to derive this interpretation by decomposing the
pressure into a constant, hydrostatically balanced reference state with a
superimposed perturbation \cite{KlempWilhelmson1978,Srivastava1967,SoongOgura1973}
so that <span class="arithmatex">\(p = \overline{p} + p'\)</span>. Combining this decomposition (and similar
treatment of temperature and density) with the equation of state leads to a
formulation of the total pressure gradient as the background hydrostatic balance
plus a perturbation due to nonhydrostatic buoyancy. In
\cite{KlempWilhelmson1978,Srivastava1967,SoongOgura1973} this arises as
quadratic terms of the perturbation variables are neglected. It is interesting
that a similar (though not equivalent\footnote{Taylor et.~al.~\cite{Taylor2020}
retain the full form of the pressure gradient, without a linearization.}) term
arises in \cite{Taylor2020} as a result of the choice of a vertical mass
coordinate based on hydrostatic pressure.</p>
<h2 id="initialization">Initialization</h2>
<p>Initial conditions are defined by stationary, <span class="arithmatex">\(w(\phi(0),0) = 0,\)</span> hydrostatic
balance with a constant lapse rate in the virtual temperature profile, and
exponential decay in the water vapor mixing ratio.</p>
<p>The initial virtual temperature profile is defined by two parameters, <span class="arithmatex">\(T_{0}\)</span>
and <span class="arithmatex">\(\Gamma_v\)</span> (with default values 300K and 0.01 K/m, respectively),</p>
<div class="arithmatex">\[\begin{equation}\label{tv}
  T_{v0}(z) = T_{0} - \Gamma_v z.
\end{equation}\]</div>
<p>Using \ref{tv} with <span class="arithmatex">\(p=\rho R T_v\)</span>, an equivalent form of the equation of state
\ref{eos}, the hydrostatic equation <span class="arithmatex">\(\partd{p}{z} = -\rho g\)</span>, and separation of
variables (again), we derive expressions that relate initial height to initial
pressure:</p>
<div class="arithmatex">\[\begin{align}
  p_0(z) = \begin{cases}
          p_{ref}\exp\left(\frac{-g z}{R T_{0}}\right) &amp; \Gamma_v = 0,\\[0.5em]
          p_{ref}\, T_0^{-g/(R\Gamma_v)}\left(T_{0} - \Gamma_v z\right)^{g/(R\Gamma_v)} &amp; \Gamma_v \ne 0,
        \end{cases} \label{eq:p_of_z}\\[0.5em]
  z_0(p) = \begin{cases}
         -\frac{R T_{0}}{g}\log\frac{p}{p_{ref}} &amp; \Gamma_v = 0,\\[0.5em]
         \frac{T_{0}}{\Gamma_v}\left(1 - \left(\frac{p}{p_{ref}}\right)^{R\Gamma_v/g}\right) &amp; \Gamma \ne 0.
       \end{cases}\label{eq:z_of_p}
\end{align}\]</div>
<p>It follows that the initial virtual potential temperature profile is defined as</p>
<div class="arithmatex">\[\begin{equation}
  \theta_{v0}(z) = T_{v0}(z)\left(\frac{p_{ref}}{p_0(z)}\right)^\kappa.
\end{equation}\]</div>
<p>The initial water vapor mixing ratio profile is also defined by two parameters, <span class="arithmatex">\(q_0\)</span> and <span class="arithmatex">\(q_1\)</span>, with default values <span class="arithmatex">\(q_0=0.015\)</span> kg H<span class="arithmatex">\(_2\)</span>O / kg air and $q_1 = $ 1E-3 m<span class="arithmatex">\(^{-1}\)</span>, as</p>
<div class="arithmatex">\[\begin{equation}\label{init_qv}
  q_{v0}(z) = q_0e^{-q_1 z}.
\end{equation}\]</div>
<p>Initial densities are defined as</p>
<div class="arithmatex">\[\begin{equation}
  \rho_0(z) = \frac{p_0(z)}{R\,T_{v0}(z)}.
\end{equation}\]</div>
<h3 id="discretized-column">Discretized Column</h3>
<p>The Haero column is defined by first setting the required parameters using the
<code>haero::driver::AtmosphericConditions</code> class. These include the model top
<span class="arithmatex">\(z_{top}\)</span>, maximum vertical velocity <span class="arithmatex">\(w_0\)</span>, and velocity period <span class="arithmatex">\(t_p\)</span> in
\ref{phi_vel}, the initial virtual temperature profile \ref{tv}, and the
initial water vapor mixing ratio profile \ref{init_qv}.</p>
<p>In the Haero driver, we emulate the vertical grid staggering used by the
HOMME-NH dynamical core \cite{Taylor2020}, which has <span class="arithmatex">\(n_{lev}\)</span> levels and
<span class="arithmatex">\(n_{lev}+1\)</span> interfaces. Levels are indexed by integer values <span class="arithmatex">\(k\)</span>, for
<span class="arithmatex">\(k=1,\dotsc,n_{lev}\)</span> and interfaces are indexed by <span class="arithmatex">\(k+1/2\)</span>, for
<span class="arithmatex">\(k=0,\dotsc,n_{lev}\)</span>.</p>
<p>In the <code>haero::driver::HostDynamics</code> class, geopotential and vertical velocity
are defined at interfaces:</p>
<div class="arithmatex">\[\begin{align}
  \phi_{k+1/2}(t) &amp;= \frac{2gz_{top}}{\pi}\arctan\left[\tan\frac{\pi \phi_{k+1/2}(0)}{2g z_{top}}\exp\left(\frac{w_0t_p}{2z_{top}} \sin^2 \frac{2\pi t}{t_p}\right)\right], \label{eq:phi_disc}\\
  w_{k+1/2}(t) &amp;= w_0 \sin \frac{\pi \phi_{k+1/2}(t)}{g z_{top}}\sin\frac{2\pi t}{t_p}. \label{eq:w_disc}
\end{align}\]</div>
<p>Similarly, density, virtual potential temperature, water vapor, and pressure are
defined at level midpoints</p>
<div class="arithmatex">\[\begin{align}
  \rho_k(t) &amp;= \rho_0(\overline{\phi_k}(0))\exp\left[\frac{ w_0 t_p}{2z_{top}}\left(\cos\frac{\pi \overline{\phi_k}(t)}{gz_{top}}\cos\frac{2\pi t}{t_p}-\cos\frac{\pi \overline{\phi_{k}}(0)}{gz_{top}}\right)\right], \label{eq:rho_disc}\\
  \theta_{vk}(t) &amp;= \theta_{v0}(\overline{\phi_k}(0)/g), \label{eq:thetav_disc} \\
  q_{vk}(t) &amp;= q_{v0}(\overline{\phi_k}(0)/g), \label{eq:qv_disc} \\
  % p_k(t) &amp;= \left(p_0^{-\kappa}R \, \rho_k(t)\,\left(\theta_v\right)_k(t)\right)^{1/(1-\kappa)},
p_k(t) &amp;=  \left(p_{ref}^{-\kappa} R \rho_k(t)\theta_{vk}(t)\right)^{1/(1-\kappa)}\label{eq:p_disc}
\end{align}\]</div>
<p>where the constants <span class="arithmatex">\(g = 9.8\)</span> m/s<span class="arithmatex">\(^2\)</span>, <span class="arithmatex">\(p_{ref} = 10^5\)</span> Pa, and
<span class="arithmatex">\(\kappa = 0.286\)</span>; the overline denotes an average,
<span class="arithmatex">\(\overline{\phi_k}(t) = (\phi_{k-1/2}(t) + \phi_{k+1/2}(t))/2\)</span>.</p>
<p>Users may opt to initialize a column with uniform spacing in either height or
pressure (at interfaces), or to specify their own height or pressure interfaces
via an input <code>.yaml</code> file. The model top is defined by \ref{z_of_p}.</p>
<p>Unit tests verify the expected 2nd order convergence of the centered finite
difference methods used by both HOMME-NH and the Haero driver, and that layer
thicknesses sum to the correct values <span class="arithmatex">\(z_{top}\)</span> and <span class="arithmatex">\(p_{top}\)</span>, as shown in the
figure below:</p>
<p><img alt="Vertical finite difference verification. Clockwise from top left:
  hydrostatic balance, hypsometric layer thickness, sum of height thicknesses,
  sum of pressure thicknesses." src="../images/vconv_plot.pdf" /></p>
<h3 id="layer-thickness">Layer thickness</h3>
<p>Layer thickness in height units is computed directly as</p>
<div class="arithmatex">\[\begin{equation}\label{z_thick}
  \Delta z_k = \left(\phi_{k-1/2} - \phi_{k+1/2}\right)/g,
\end{equation}\]</div>
<p>which reflects the true thickness of a model level in our non-hydrostatic model.
However, some legacy parameterizations require thickness defined in <em>pressure</em>
units. To support these parameterizations, we compute <code>hydrostatic_dp</code> as a
member of the <code>HostDynamics</code> class.</p>
<p>This calculation begins by defining the hydrostatic pressure <span class="arithmatex">\(p_H\)</span> at each
interface, <span class="arithmatex">\(p_{H,k+1/2} = p(\phi_{k+1/2}/g)\)</span> using \ref{z_of_p}. Then the layer
thickness is computed as</p>
<div class="arithmatex">\[\begin{equation}\label{p_thick}
  \Delta p_{Hk} = p_{H,k+1/2} - p_{H,k-1/2}.
\end{equation}\]</div>
<div class="admonition info">
<p class="admonition-title">Hydrostatic layer thickness</p>
<p>Pressure thickness is computed via the hydrostatic approximation.</p>
</div>
<p>The interface hydrostatic pressures <span class="arithmatex">\(p_H\)</span> are stored as a private variable, to
prevent users from mistaking them for the full non-hydrostatic pressure.</p>
<h3 id="creating-a-haero-atmosphere">Creating a Haero atmosphere</h3>
<p>The above dynamics are motivated by the input requirements of the various
parameterizations. These are encapsulated by the <code>haero::Atmosphere</code> class,
which requires temperature, pressure, height, and relative humidity data. We
already have pressure and height.</p>
<p>Temperature may be diagnosed using the approximation given by
\cite[eq.~(2.3)]{KlempWilhelmson1978},</p>
<div class="arithmatex">\[\begin{equation}\label{approx_temp}
  T_k(t) \approx \frac{\theta_{vk}(t) ~ \Pi_k(t)}{1+\alpha_q ~ q_{vk}(t)},
\end{equation}\]</div>
<p>with constant <span class="arithmatex">\(\alpha_q = 0.61\)</span>.</p>
<p><img alt="Temperature for the same parameters as in the figures for the geopotential,
  density, and pressure, with the additional parameters \(q_{0}=6\)E-3,
  \(q_1=2.5\)E-3." src="../images/temperature_plot.pdf" /></p>
<p>We compute relative humidity as <span class="arithmatex">\(s = q_v/q_{vsat}\)</span>, where <span class="arithmatex">\(q_{vsat}\)</span> is the saturation mixing ratio.
We use the Tetens equation to find <span class="arithmatex">\(q_{vsat}\)</span> \cite[eqn. (A1)]{SoongOgura1973},
\begin{equation}\label{eq:tetens}
  q_{vs}(T) = \frac{380.042}{p}\exp\left(\frac{15}{2}\log(10) \frac{T-273}{T-36}\right).
\end{equation}</p>
<p><img alt="Temperature for the same parameters as in the figures for the geopotential,
  density, and pressure, with the additional parameters \(q_{0}=6\)E-3,
  \(q_1=2.5\)E-3." src="../images/relhumidity_plot.pdf" /></p>
<h2 id="time-stepping">Time Stepping</h2>
<p>The above dynamics are associated with the following <em>tendencies</em>, the
right-hand sides of \ref{geo_traj} and \ref{1d}</p>
<div class="arithmatex">\[\begin{align}
  \dot{w}(\phi,t) \equiv \totd{w}  &amp;= \frac{2\pi w_0}{t_p}\sin\frac{\pi\phi}{gz_{top}}\cos\frac{2\pi t}{t_p} + \frac{\pi w_0^2}{2z_{top}}\sin\frac{2\pi\phi}{gz_{top}}\sin^2\frac{2\pi t}{t_p},\\
  \dot{\phi}(\phi,t) \equiv \totd{\phi} &amp;= gw_0 \sin \frac{\pi \phi}{g z_{top}}\sin\frac{2\pi t}{t_p},\\
  \dot{\rho}(\phi, t, \rho) \equiv \totd{\rho} &amp;= -\rho \frac{\pi w_0}{z_{top}}\cos\frac{\pi \phi}{g z_{top}}\sin\frac{2\pi t}{t_p},\\
  \dot{\theta_v} \equiv \totd{\theta_v} &amp;= 0,\\
  \dot{q_v} \equiv \totd{q_v} &amp;= 0,
\end{align}\]</div>
<p>where the dot denotes differentiation with respect to time.</p>
<h3 id="simple-microphysics">Simple microphysics</h3>
<p>A simple cloud model with warm-rain microphysics, often called \emph{Kessler microphysics}, is summarized in \cite[ch.~15]{RogersYau}, which references \cite{Srivastava1967}.
It introduces mass mixing ratio tracers for cloud liquid water <span class="arithmatex">\(q_c\)</span> and rain water <span class="arithmatex">\(q_r\)</span> and source terms for the dynamics equations.
We use \cite{SoongOgura1973,KlempWilhelmson1978} as additional references.
We adapt this microphysics model here to match the HOMME-NH dynamics variables.</p>
<p>The two new tracers are advected passively by the dynamics (without source and sink terms) in the same manner as water vapor,</p>
<div class="arithmatex">\[\begin{align}
  \dot{q_c} \equiv \deriv{q_c}{t} &amp;= 0,\\
  \dot{q_r} \equiv \deriv{q_r}{t} &amp;= 0.
\end{align}\]</div>
<p>Microphysical parameterizations define approximate source and sink terms to correspond to a select (incomplete) set of physical processes, as described below.</p>
<h4 id="vertical-velocity">Vertical velocity</h4>
<p>The vertical velocity <span class="arithmatex">\(w\)</span> is adjusted to account for loss of buoyancy due to the
mass of suspended liquid water,</p>
<div class="arithmatex">\[\begin{equation}
  \dot{w} \pluseq -g(q_c+q_r).
\end{equation}\]</div>
<h4 id="evaporation-and-condensation">Evaporation and condensation</h4>
<p>Our first step assumes unsaturated air, <span class="arithmatex">\(q_v \le q_{vs}\)</span>, where <span class="arithmatex">\(q_{vs}\)</span> is the
saturation mixing ratio defined by \ref{tetens} using the temperature computed
by \ref{approx_temp},</p>
<div class="arithmatex">\[\begin{align}
  \dot{q_v} &amp;\pluseq E_{cv} + E_{rv}, \\
  \dot{q_c} &amp;\minuseq E_{cv}, \\
  \dot{q_r} &amp;\minuseq E_{rv},  \\
  \dot{\theta_v} &amp;\minuseq \frac{L}{c_p \Pi}(E_{cv} + E_{rv}),
\end{align}\]</div>
<p>where <span class="arithmatex">\(E_{cv}\)</span> and <span class="arithmatex">\(E_{rv}\)</span> denote the evaporation rates between cloud
liquid/water vapor and rain/water vapor, respectively.</p>
<div class="arithmatex">\[\begin{equation}\label{cloud2vapor_evap}
  E_{cv} = \begin{cases} q_c &amp; \text{if } q_v &lt; q_{vs} \\ 0 &amp; \text{otherwise}\end{cases}
\end{equation}\]</div>
<div class="arithmatex">\[\begin{equation}
  E_{rv} = \begin{cases} \frac{(1-q_v/q_{vs}) C_{vt} (\rho q_r)^{0.525}}{\rho 5.4\text{E}5 + 4.1\text{E}6/e_s(T)} &amp; \text{if } q_v &lt; q_{vs} \text{ and } q_c = 0 \\ 0 &amp; \text{otherwise}\end{cases}
\end{equation}\]</div>
<p>The ventillation coefficient <span class="arithmatex">\(C_{vt} = 1.6 + 5.7\text{E-}2V_r^{3/2}\)</span> for rain
falling at speed <span class="arithmatex">\(V_r\)</span> relative to the air, and <span class="arithmatex">\(e_s(T)\)</span> is the saturation vapor
pressure for a planar liquid water surface at temperature <span class="arithmatex">\(T\)</span>.
The latter two values are approximated as \cite[eqn.~(15))]{SoongOgura1973},
\begin{align}
  V_r &amp; = 36.34 (1\text{E}3\rho q_r)^{0.1364} \text{ m/s},\
  e_s(T) &amp; = 6.1094\exp\left( \frac{17.625 (T-273)}{T-29.96} \right)\text{ hPa}.
\end{align}</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The exponent 0.1364 in the fall velocity expression is as written in
\cite[eqn. (15)]{SoongOgura1973}; in  \cite[eqn.~(2.15)]{KlempWilhelmson1978}
it's written as 0.1346.</p>
<p>The authors of \cite{KlempWilhelmson1978} modify the expression used in
\cite{SoongOgura1973} to include a reference density term (and make a similar
modification to the ventilation coefficient). Since this modification is
unrelated to the exponent, we have assumed that 0.1346 is a typographical error
and we use the value from \cite{SoongOgura1973} in this work.</p>
</div>
<p>A second step \cite[eqns.(A7)--(A10)]{SoongOgura1973} conducts an adjustment for
supersaturated air, <span class="arithmatex">\(q_v &gt; q_{vs}\)</span>, after the time stepping procedure implied by
\ref{evap} is finished.</p>
<p>Let these values be denoted by a star: <span class="arithmatex">\(\theta_v^*\)</span>, <span class="arithmatex">\(q_v^*\)</span>, <span class="arithmatex">\(q_c^*\)</span>, etc.</p>
<p>Define the factor <span class="arithmatex">\(r_1\)</span>,
\begin{equation}
  r_1 = \left(1 + \frac{237 a\Pi q_{vs}^<em>}{(T^</em>-36)^2}\frac{L}{c_p\Pi} \right)^{-1}.
\end{equation}</p>
<p>Then the adjusted values are given as</p>
<div class="arithmatex">\[\begin{align}
  q_v &amp;= q_{v}^* - r_1(q_v^*-q_{vs}^*),\\
  \theta_v &amp; = \left(\theta^* + \frac{Lr_1}{c_p\Pi}(q_v^*-q_{vs}^*)\right)\left(1 + \alpha_v q_v\right),\\
  q_c &amp;= q_v^* + q_c^* - q_v.
\end{align}\]</div>
<h4 id="autoconversion">Autoconversion</h4>
<p>Autoconversion of cloud liquid into rain only occurs in the presence of
sufficient cloud water droplets. Here, "sufficient" is defined as greater than
a constant critical value, <span class="arithmatex">\(q_c^{(crit)}\)</span>, and \cite[eqn.~(12)]{Srivastava1967}</p>
<div class="arithmatex">\[\begin{align}
  \dot{q_c} &amp;\minuseq \alpha_{auto}(q_c - q_c^{(crit)})_+,\\
  \dot{q_r} &amp;\pluseq \alpha_{auto}(q_c - q_c^{(crit)})_+,
\end{align}\]</div>
<p>where <span class="arithmatex">\(\alpha_{auto}\)</span> [1/s] is the inverse of the autoconversion time scale and
<span class="arithmatex">\(q_c^{(crit)}\)</span> is a user-defined parameter. In \cite{SoongOgura1973},
<span class="arithmatex">\(\alpha_{auto}=1\text{E-3}\)</span> s<span class="arithmatex">\(^{-1}\)</span> and <span class="arithmatex">\(q_c^{(crit)} = 1\text{E-3}\)</span>.</p>
<h4 id="accretion">Accretion</h4>
<p>Accretion describes the capture of cloud water droplets by rainwater droplets.
As in \cite{SoongOgura1973,KlempWilhelmson1978}, we use</p>
<div class="arithmatex">\[\begin{align}
  \dot{q_c} &amp;\minuseq \alpha_{accr}q_cq_r^{7/8}, \\
  \dot{q_r} &amp;\pluseq \alpha_{accr} q_c q_r^{7/8},
\end{align}\]</div>
<p>with <span class="arithmatex">\(\alpha_{accr} = 2.2\)</span>.</p>
<h4 id="rainwater-sedimentation">Rainwater sedimentation</h4>
<div class="arithmatex">\[\begin{equation}
  \dot{q_r} \minuseq \frac{1}{\rho}\partd{}{z}(\rho V_rq_r)
\end{equation}\]</div>
<p>At the model top, this term is zero.</p>
<h4 id="turbulent-mixing">Turbulent mixing</h4>
<p>We modify sub-grid scale turbulence mode of \cite{KlempWilhelmson1978} to use a simple Smagorinsky turbulent eddy mixing coefficient,</p>
<div class="arithmatex">\[\begin{equation}
  K_m = \sqrt{2}\left(\frac{7l}{50}\right)^2 \abs{\partd{w}{z}}.
\end{equation}\]</div>
<p>The additional source terms are \cite[eqns.~(3.15)--(3.16)]{KlempWilhelmson1978}</p>
<div class="arithmatex">\[\begin{align}
  \dot{w} &amp;\pluseq 2 \partd{}{z}\left(K_m \partd{w}{z}\right) - \frac{20}{3 l^2}K_m\partd{K_m}{z},\\
  \dot{q_v} &amp;\pluseq 3\partd{}{z}\left(K_m\partd{q_v}{z}\right), \\
  \dot{q_c} &amp;\pluseq 3\partd{}{z}\left(K_m\partd{q_c}{z}\right), \\
  \dot{\theta} &amp;\pluseq 3\partd{}{z}\left(K_m\partd{\theta}{z}\right).
\end{align}\]</div>
<h3 id="embedded-parameterization">Embedded parameterization</h3>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../processes/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Aerosol Processes" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Aerosol Processes
            </div>
          </div>
        </a>
      
      
        
        <a href="../testing/" class="md-footer__link md-footer__link--next" aria-label="Next: Testing Aerosol Processes" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Testing Aerosol Processes
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.indices", "navigation.instant", "navigation.sections", "navigation.top"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.960e086b.min.js"></script>
      
        <script src="../javascript/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>